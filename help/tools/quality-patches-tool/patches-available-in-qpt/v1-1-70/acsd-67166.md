---
title: 'ACSD-67166: Dubblett av körningen av frågan "catalog_stock_status" vid inläsning av en offert på butiken'
description: Använd korrigeringsfilen ACSD-67166 för att åtgärda Adobe Commerce-problemet där dubblettkörning av frågan "catalog_stock_status" inträffar när en offert läses in på butiken, vilket orsakar redundanta DB-anrop.
feature: Inventory
role: Admin, Developer
type: Troubleshooting
source-git-commit: ef596770b58528f9dddb4bd1650d7cbed0bf0b95
workflow-type: tm+mt
source-wordcount: '344'
ht-degree: 0%

---


# ACSD-67166: Dubblettkörning av `cataloginventory_stock_status`-frågan när en offert läses in på butiken

ACSD-67166-korrigeringen åtgärdar ett problem där dubblettkörning av `cataloginventory_stock_status`-frågan inträffar när en offert läses in på butiken, vilket orsakar redundanta DB-anrop. Den här korrigeringen är tillgänglig när [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70 har installerats. Korrigerings-ID är ACSD-67166. Observera att problemet är planerat att åtgärdas i Adobe Commerce 2.4.9.

## Berörda produkter och versioner

**Korrigeringen har skapats för Adobe Commerce-version:**

* Adobe Commerce (alla distributionsmetoder) 2.4.5-p13

**Kompatibel med Adobe Commerce-versioner:**

* Adobe Commerce (alla distributionsmetoder) 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>Korrigeringen kan bli tillämplig för andra versioner med nya [!DNL Quality Patches Tool]-versioner. Om du vill kontrollera om korrigeringen är kompatibel med din Adobe Commerce-version uppdaterar du `magento/quality-patches`-paketet till den senaste versionen och kontrollerar kompatibiliteten på [[!DNL Quality Patches Tool]: Sök efter korrigeringsfiler ](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html?lang=sv-SE). Använd patch-ID:t som söknyckelord för att hitta patchen.

## Problem

Duplicerad körning av `cataloginventory_stock_status`-frågan inträffar när en offert läses in på butiken, vilket orsakar redundanta DB-anrop.

<u>Steg som ska återskapas</u>:

1. Installera en ren instans.
1. Skapa en **[!UICONTROL Category]** och en **[!UICONTROL Simple Product]**.
1. Gå till kategorin och lägg till en produkt i kundvagnen.
1. Gå till kundvagnssidan: `/checkout/cart/`
1. Ange brytpunkter i [!DNL xDebug]:
   1. `app/code/Magento/CatalogInventory/Model/StockRegistryPreloader.php:115`
   1. `app/code/Magento/InventoryCatalog/Model/LegacyStockStatusCache.php:73`
   1. `lib/internal/Magento/Framework/Data/AbstractSearchResult.php:233`
   1. **Brytpunktsvillkor**: `strpos($this->query->getSelectSql(true), 'stock_status') !==false`
Lägg till `$_SERVER['REQUEST_URI']` i *bevakningar* i [!DNL PHPStorm] för att verifiera att frågan anropas två gånger inom samma begäran.

<u>Förväntade resultat</u>:

Frågan körs en gång per begäran.

<u>Faktiska resultat</u>:

Samma fråga körs två gånger:

```
SELECT `main_table`.*, `cp_table`.`sku`, `cp_table`.`type_id` FROM `cataloginventory_stock_status` AS `main_table`
 INNER JOIN `catalog_product_entity` AS `cp_table` ON main_table.product_id = cp_table.entity_id AND (cp_table.created_in <= 1 AND cp_table.updated_in > 1) WHERE (`main_table`.`product_id` IN(2)) AND (`main_table`.`website_id` = '0') 
```

## Tillämpa korrigeringen

Använd följande länkar beroende på distributionsmetod för att tillämpa enskilda korrigeringsfiler:

* Lokal användning för Adobe Commerce eller Magento Open Source: [[!DNL Quality Patches Tool] > Användning ](/help/tools/quality-patches-tool/usage.md) i guiden [!DNL Quality Patches Tool]
* Adobe Commerce om molninfrastruktur: [Uppgraderingar och korrigeringar > Tillämpa korrigeringar](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html?lang=sv-SE) i guiden för Commerce om molninfrastruktur

## Relaterad läsning

Mer information om [!DNL Quality Patches Tool] finns i:

* [[!DNL Quality Patches Tool]: Ett självbetjäningsverktyg för kvalitetspatchar](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) i verktygshandboken
